@using GameStoreData.Identity.Data;
@using GameStoreData.Service;
@using Microsoft.AspNetCore.Identity;

@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager
@inject GameService GameService

@model GameStoreData.Models.Game

@{
    ViewData["Title"] = "GetGame";
}

<h1>Game Details</h1>
<hr />

<div>
    <dl class="row">
        <dd class="col-sm-10">
            <img src="@Model.Image" alt="image" height="100" width="100">
        </dd>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Name)
        </dd>
        <dd class="col-sm-10">
            @{ string s = String.Join("/", Model.Genres.Select(g => g.Name)); }
            @(string.IsNullOrEmpty(s) ? "No Genre" : s)
        </dd>
        <dd class = "col-sm-10">
            $@Html.DisplayFor(model => model.Price)
        </dd>
    </dl>
</div>
<div>
    @if (SignInManager.IsSignedIn(User))
    {
        @if (!UserManager.GetRolesAsync(UserManager
        .GetUserAsync(User).Result).Result.Contains("User"))
        {
            <a asp-action="Edit" asp-route-id="@Model?.Id" class="newgame">Edit</a>
        }
        <a asp-action="AddToCart" asp-route-id="@Model?.Id" class="buygame">Add</a>
    }
    else {
        <a asp-action="BuyGames" asp-route-id="@Model?.Id" class="buygame">Buy</a>
    }

    <a asp-action="Index" asp-controller="Game" class="newgame">Go Back</a>

    @{
        <partial name="_CommentsPartial" model="@Model.CommentVM"/>
    }

</div>
